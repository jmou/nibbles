import { PLAYER_1, PLAYER_2, SYSTEM, on } from "@rcade/plugin-input-classic";
import {
  PLAYER_1 as SPINNER_1,
  PLAYER_2 as SPINNER_2,
} from "@rcade/plugin-input-spinners";
import "./style.css";
import { CELL, GLYPH_BLOCK, GLYPHS } from "./glyphs";

const SCREEN_WIDTH = 320;
const SCREEN_HEIGHT = 240;

const COLUMNS = 80;
const ROWS = 24; // QBasic used 25 rows

const PIXELS_PER_COLUMN = SCREEN_WIDTH / COLUMNS;
const PIXELS_PER_ROW = SCREEN_HEIGHT / ROWS;

const QUANTIZATION = 3;
const VELOCITY = 1 / QUANTIZATION;

type AppState = "title" | "pre" | "level" | "post";

interface ScreenPosition {
  x: number;
  y: number;
}

interface GridPosition {
  u: number;
  v: number;
}

const U_MAX = COLUMNS - 1;
const V_MAX = ROWS * 2 - 1;
const CELL_WIDTH = PIXELS_PER_COLUMN;
const CELL_HEIGHT = PIXELS_PER_ROW / 2;

type Heading = number;
const RIGHT = 0;
const DOWN = Math.PI / 2;
const LEFT = Math.PI;
const UP = (Math.PI * 3) / 2;

type Color = { r: number; g: number; b: number };
const BLUE = { r: 0, g: 0, b: 255 };
const WHITE = { r: 255, g: 255, b: 255 };
const YELLOW = { r: 255, g: 255, b: 0 };
const MAGENTA = { r: 255, g: 0, b: 255 };
const SALMON = { r: 255, g: 85, b: 85 };

type Alpha = number;
const TRIAL = 0;
const MATURE = 255;
const YOUNG = MATURE - 3 * QUANTIZATION;

let pickup = 1;
let pickupPosition = { u: 0, v: 0 };

interface PlayerInput {
  dpad: ("UP" | "DOWN" | "LEFT" | "RIGHT")[];
  a: boolean;
  b: boolean;
}

interface Snake {
  front: GridPosition;
  trail: (GridPosition | null)[];
  length: number;
  heading: Heading;
  lives: number;
  score: number;
  quantized: boolean;
  name: string;
  color: Color;
  input: PlayerInput;
  // TODO hack
  lastSpinner: number | null;
}

const snakes: Snake[] = [];

const app = document.querySelector<HTMLDivElement>("#app")!;
app.innerHTML = `
  <div>
    <div id=overlay></div>
    <canvas id=canvas width=${SCREEN_WIDTH} height=${SCREEN_HEIGHT}></canvas>
  </div>
  <svg>
    <defs>
      <filter id="bubble">
        <feImage xlink:href="data:image/png;base64,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" result="lightMap" x="0" y="0" width="320" height="240"/>
        <feDisplacementMap in2="lightMap" in="SourceGraphic" xChannelSelector="R" yChannelSelector="G" scale="5" />
        <feComposite operator="in" in2="lightMap"></feComposite>
      </filter>
      <filter id="bloom">
        <feGaussianBlur in="SourceGraphic" stdDeviation="5" />
        <feComposite in2="SourceGraphic" operator="arithmetic" k2="0.4" k3="1" />
      </filter>
    </defs>
  </svg>
`;

const canvas = document.querySelector<HTMLCanvasElement>("#canvas")!;
const ctx = canvas.getContext("2d")!;

const bitmap = ctx.createImageData(SCREEN_WIDTH, SCREEN_HEIGHT);

function cls() {
  for (let i = 0; i < bitmap.data.length; i++) {
    bitmap.data[i] = i % 4 < 2 ? 0 : 255; // blue
  }
}

type PixelOp = (pos: ScreenPosition, color: Color) => boolean;

function paint({ x, y }: ScreenPosition, color: Color, alpha: Alpha = MATURE) {
  const index = (y * SCREEN_WIDTH + x) * 4;
  if (index + 3 >= bitmap.data.length) return false;
  bitmap.data[index] = color.r;
  bitmap.data[index + 1] = color.g;
  bitmap.data[index + 2] = color.b;
  bitmap.data[index + 3] = alpha;
  return true;
}

function trial(pos: ScreenPosition, color: Color) {
  const collision = !mature(pos, BLUE);

  // TODO clean up
  const { x, y } = pos;
  const index = (y * SCREEN_WIDTH + x) * 4;
  if (!collision || bitmap.data[index + 3] === TRIAL) {
    paint(pos, color, TRIAL);
  }

  return true;
}

function equals(pos: ScreenPosition, color: Color, alpha: Alpha = TRIAL) {
  const { x, y } = pos;
  const index = (y * SCREEN_WIDTH + x) * 4;
  return (
    bitmap.data[index] === color.r &&
    bitmap.data[index + 1] === color.g &&
    bitmap.data[index + 2] === color.b &&
    bitmap.data[index + 3] === alpha
  );
}

function mature(pos: ScreenPosition, color: Color) {
  return equals(pos, color, MATURE);
}

// TODO dedupe w/ equals
function safe(pos: ScreenPosition, color: Color) {
  const { x, y } = pos;
  const index = (y * SCREEN_WIDTH + x) * 4;
  return (
    bitmap.data[index] === color.r &&
    bitmap.data[index + 1] === color.g &&
    bitmap.data[index + 2] === color.b &&
    bitmap.data[index + 3] < MATURE
  );
}

function graduate(pos: ScreenPosition, _color: Color) {
  const { x, y } = pos;
  const index = (y * SCREEN_WIDTH + x) * 4;
  bitmap.data[index + 3] = YOUNG;
  return true;
}

function age(pos: GridPosition) {
  const x0 = Math.round(pos.u * CELL_WIDTH);
  const y0 = Math.round(pos.v * CELL_HEIGHT);

  // FIXME dimensions should be clamped
  for (let x = x0 - 10; x < x0 + 10; x++) {
    for (let y = y0 - 10; y < y0 + 10; y++) {
      const index = (y * SCREEN_WIDTH + x) * 4;
      if (bitmap.data[index + 3] >= YOUNG && bitmap.data[index + 3] < MATURE) {
        bitmap.data[index + 3]++;
      }
    }
  }
}

function blit(
  pos: ScreenPosition | GridPosition,
  glyph: boolean[][],
  color: Color,
  op: PixelOp = paint,
  { all = true }: { all?: boolean } = {}
) {
  if ("u" in pos) {
    const x = Math.round(pos.u * CELL_WIDTH);
    const y = Math.round(pos.v * CELL_HEIGHT);
    pos = { x, y };
  }

  let ret = all;
  for (const [dy, row] of glyph.entries()) {
    for (const [dx, fill] of row.entries()) {
      if (fill) {
        const one = op({ x: pos.x + dx, y: pos.y + dy }, color);
        ret = all ? ret && one : ret || one;
      }
    }
  }
  return ret;
}

function apply(
  pos: ScreenPosition | GridPosition,
  color: Color,
  op: PixelOp = paint
) {
  if ("x" in pos) {
    return op(pos, color);
  } else {
    return blit(pos, CELL, color, op);
  }
}

function erase(pos: GridPosition) {
  blit(pos, CELL, BLUE);
}

function wall(row: number, col: number) {
  apply({ u: col - 1, v: row - 1 }, SALMON);
}

function hrule(row: number, col1: number, col2: number) {
  for (let col = col1; col <= col2; col++) wall(row, col);
}

function vrule(col: number, row1: number, row2: number) {
  for (let row = row1; row <= row2; row++) wall(row, col);
}

function text(pos: GridPosition, s: string) {
  for (const [i, ch] of [...s].entries()) {
    const blitPos = { u: pos.u + i * 2, v: pos.v };
    blit(blitPos, GLYPH_BLOCK, BLUE);
    blit(blitPos, GLYPHS[ch], WHITE);
  }
}

function center(row: number, s: string) {
  text({ u: COLUMNS / 2 - s.length, v: row * 2 }, s);
}

function halfHeader(sammy: Snake, left: boolean) {
  let score = String(sammy.score);
  if (left) {
    score = score.padEnd(6);
  } else {
    score = score.padStart(6);
  }
  const arrow = left ? " <-" : "-> ";
  const name = sammy.name.toUpperCase();
  let lives = "@".repeat(sammy.lives);
  if (left) {
    lives = lives.padStart(5);
  } else {
    lives = lives.padEnd(5);
  }
  const pieces = [score, lives, arrow, name];
  if (!left) pieces.reverse();
  return pieces.join("");
}

function header() {
  for (let u = 0; u <= U_MAX; u++) {
    erase({ u, v: 0 });
    erase({ u, v: 1 });
  }

  if (snakes.length === 0) return;

  const left = halfHeader(snakes[0], true);
  text({ u: 0, v: 0 }, left);

  if (snakes[1]) {
    const right = halfHeader(snakes[1], false);
    const u = U_MAX - right.length * 2 + 1;
    text({ u, v: 0 }, right);
  }
}

let speed = 50;
let level = 0;
let clock = 0;
let state: AppState = "title";

let tickHandle: number;
function resetTickInterval() {
  const speedScale = 1 - (speed - 50) / 100;
  const renderInterval = (speedScale * 1000) / 30;
  clearInterval(tickHandle);
  tickHandle = setInterval(tick, renderInterval);
}

function redrawTitleSettings() {
  center(13, `  Speed: ${speed}  `);
  center(14, speed === 100 ? "Twiddle Fingers" : "               ");
}

function title(msg: string = "Nibbles!") {
  cls();
  center(0, msg);
  center(9, "Press P1 or P2");
  redrawTitleSettings();

  const oldSpeed = speed;
  speed = 50;
  resetTickInterval();
  speed = oldSpeed;

  level = 0;
  clock = 0;
  state = "title";
}

function lose() {
  title("G A M E   O V E R");
}

function win() {
  title("You win!");
}

function addSnake(name: string, color: Color) {
  snakes.push({
    front: { u: 0, v: 0 },
    trail: [],
    length: QUANTIZATION,
    heading: RIGHT,
    lives: 5,
    score: 0,
    quantized: true,
    name,
    color,
    input: { dpad: [], a: false, b: false },
    lastSpinner: null,
  });
}

type Spawn = [number, number, Heading];

interface Level {
  spawns: [Spawn, Spawn];
  walls: () => void;
}

const LEVELS: Record<string, Level> = {
  1: {
    spawns: [
      [30, 25, LEFT],
      [50, 25, RIGHT],
    ],
    walls: () => {},
  },
  2: {
    spawns: [
      [20, 43, LEFT],
      [60, 7, RIGHT],
    ],
    walls: () => hrule(25, 20, 60),
  },
  3: {
    spawns: [
      [30, 25, DOWN],
      [50, 25, UP],
    ],
    walls: () => {
      vrule(20, 10, 40);
      vrule(60, 10, 40);
    },
  },
  4: {
    spawns: [
      [20, 43, RIGHT],
      [60, 7, LEFT],
    ],
    walls: () => {
      vrule(20, 4, 30);
      vrule(60, 23, 49);
      hrule(38, 2, 40);
      hrule(15, 41, 79);
    },
  },
  5: {
    spawns: [
      [30, 25, DOWN],
      [50, 25, UP],
    ],
    walls: () => {
      vrule(21, 13, 39);
      vrule(59, 13, 39);
      hrule(11, 23, 57);
      hrule(41, 23, 57);
    },
  },
  6: {
    spawns: [
      [15, 43, UP],
      [65, 7, DOWN],
    ],
    walls: () => {
      for (let i = 4; i <= 49; i++) {
        if (i > 30 || i < 23) {
          wall(i, 10);
          wall(i, 20);
          wall(i, 30);
          wall(i, 40);
          wall(i, 50);
          wall(i, 60);
          wall(i, 70);
        }
      }
    },
  },
  7: {
    spawns: [
      [15, 43, UP],
      [65, 7, DOWN],
    ],
    walls: () => {
      for (let i = 4; i <= 49; i += 2) {
        wall(i, 40);
      }
    },
  },
  8: {
    spawns: [
      [15, 43, UP],
      [65, 7, DOWN],
    ],
    walls: () => {
      for (let i = 4; i <= 40; i++) {
        wall(i, 10);
        wall(53 - i, 20);
        wall(i, 30);
        wall(53 - i, 40);
        wall(i, 50);
        wall(53 - i, 60);
        wall(i, 70);
      }
    },
  },
  9: {
    spawns: [
      [5, 15, DOWN],
      [75, 40, UP],
    ],
    walls: () => {
      for (let i = 6; i <= 45; i++) {
        wall(i, i);
        wall(i, i + 30);
      }
    },
  },
  10: {
    spawns: [
      [15, 43, UP],
      [65, 7, DOWN],
    ],
    walls: () => {
      for (let i = 4; i <= 49; i += 2) {
        wall(i, 10);
        wall(i + 1, 20);
        wall(i, 30);
        wall(i + 1, 40);
        wall(i, 50);
        wall(i + 1, 60);
        wall(i, 70);
      }
    },
  },
};

function renderLevel() {
  cls();

  // Borders
  hrule(3, 1, COLUMNS);
  hrule(ROWS * 2, 1, COLUMNS);
  vrule(1, 3, ROWS * 2);
  vrule(COLUMNS, 3, ROWS * 2);

  const { spawns, walls } = LEVELS[level];

  walls();

  for (const [i, snake] of snakes.entries()) {
    const [col, row, heading] = spawns[i];
    snake.front = { u: col - 1, v: row - 1 };
    snake.trail = [];
    snake.heading = heading;
    snake.length = QUANTIZATION;
  }
}

function nextLevel() {
  level++;
  if (!(level in LEVELS)) {
    win();
    return false;
  }

  renderLevel();

  dialog(`Level ${level}\nPress A`);
  state = "pre";
  return true;
}

function dialog(msg: string) {
  for (const [i, line] of msg.split("\n").entries()) {
    center(11 + i, line);
  }
}

function add(pos: GridPosition, heading: Heading, distance: number = VELOCITY) {
  let { u, v } = pos;
  u += distance * Math.cos(heading);
  v += distance * Math.sin(heading);
  return { u, v };
}

function dropPickup() {
  while (true) {
    const u = Math.floor(Math.random() * (U_MAX + 1));
    const v = Math.floor(Math.random() * (V_MAX + 1));

    if (blit({ u, v }, GLYPHS[pickup], BLUE, mature)) {
      pickupPosition = { u, v };
      blit({ u, v }, GLYPHS[pickup], WHITE);
      break;
    }
  }
}

function turn(sammy: Snake, spinner: typeof SPINNER_1.SPINNER) {
  if (sammy.lastSpinner == null) {
    sammy.lastSpinner = spinner.angle;
  } else if (spinner.angle != sammy.lastSpinner) {
    sammy.heading += spinner.angle - sammy.lastSpinner;
    sammy.lastSpinner = spinner.angle;
    sammy.quantized = false;
  }

  if (clock % QUANTIZATION !== 0) return;
  const dpad = sammy.input.dpad.shift();
  if (dpad === "UP" && sammy.heading !== DOWN) {
    sammy.heading = UP;
    sammy.quantized = true;
  } else if (dpad === "DOWN" && sammy.heading !== UP) {
    sammy.heading = DOWN;
    sammy.quantized = true;
  } else if (dpad === "LEFT" && sammy.heading !== RIGHT) {
    sammy.heading = LEFT;
    sammy.quantized = true;
  } else if (dpad === "RIGHT" && sammy.heading !== LEFT) {
    sammy.heading = RIGHT;
    sammy.quantized = true;
  }
}

function anyButton() {
  for (const snake of snakes) {
    if (snake.input.a || snake.input.b) return true;
  }
  return false;
}

function tick() {
  if (state === "title") {
    if (SYSTEM.ONE_PLAYER) {
      snakes.length = 0;
      addSnake("Sammy", YELLOW);
      resetTickInterval();
      nextLevel();
    } else if (SYSTEM.TWO_PLAYER) {
      snakes.length = 0;
      addSnake("Sammy", YELLOW);
      addSnake("Jake", MAGENTA);
      resetTickInterval();
      nextLevel();
    } else if (PLAYER_1.DPAD.left || PLAYER_2.DPAD.left) {
      if (speed > 1) speed--;
      redrawTitleSettings();
    } else if (PLAYER_1.DPAD.right || PLAYER_2.DPAD.right) {
      if (speed < 100) speed++;
      redrawTitleSettings();
    }
  } else if (state === "pre") {
    if (anyButton()) {
      if (snakes.some(({ lives }) => lives === 0)) {
        lose();
      } else {
        renderLevel();

        pickup = 1;
        dropPickup();

        state = "level";
      }
    }
  } else if (state === "post") {
    if (anyButton()) nextLevel();
  } else if (state === "level") {
    // Skip level debug cheat.
    if (PLAYER_1.A && PLAYER_1.B && PLAYER_2.A && PLAYER_2.B) {
      if (nextLevel()) state = "pre";
      for (const sammy of snakes) {
        sammy.input.a = false;
        sammy.input.b = false;
      }
      return;
    }

    clock++;
    const quantumTick = clock % QUANTIZATION === 0;

    for (const sammy of snakes) {
      // FIXME this will overage if two snake fronts are too close
      age(sammy.front);
    }

    turn(snakes[0], SPINNER_1.SPINNER);
    if (snakes.length > 1) turn(snakes[1], SPINNER_2.SPINNER);

    for (const sammy of snakes) {
      if (sammy.quantized && !quantumTick) {
        sammy.trail.push(null);
      } else {
        sammy.trail.push(sammy.front);
        // TODO tidy
        sammy.front = add(
          sammy.front,
          sammy.heading,
          sammy.quantized ? VELOCITY * QUANTIZATION : VELOCITY
        );
        if (sammy.quantized) {
          // TODO can cause discontinuities
          sammy.front.u = Math.round(sammy.front.u);
          sammy.front.v = Math.round(sammy.front.v);
        }
        while (sammy.trail.length > sammy.length) {
          const [vacated] = sammy.trail.splice(0, 1);
          if (vacated) erase(vacated);
        }
      }
    }

    let collected = false;
    for (const sammy of snakes) {
      if (blit(sammy.front, CELL, WHITE, mature, { all: false })) {
        sammy.length += pickup * 4 * QUANTIZATION;
        sammy.score += pickup * 100;
        collected = true;
      }
    }
    if (collected) {
      blit(pickupPosition, GLYPHS[pickup.toString()], BLUE);
      if (pickup === 9) {
        if (!nextLevel()) return;
      } else {
        pickup++;
        dropPickup();
      }
    }

    // Extend snakes after truncating trail to allow snake front to occupy
    // vacated tail.
    for (const sammy of snakes) {
      if (sammy.quantized && !quantumTick) continue;
      apply(sammy.front, sammy.color, trial);
    }

    // FIXME should collision detect in between quanta
    const dead = snakes.filter(
      (sammy) =>
        (!sammy.quantized || quantumTick) &&
        !apply(sammy.front, sammy.color, safe)
    );
    if (dead.length > 0) {
      for (const snake of dead) snake.lives--;
      dialog(dead.map(({ name }) => `${name} Dies!`).join("\n"));
      state = "pre";
      // FIXME resolve trial colors
    }

    for (const sammy of snakes) {
      if (sammy.quantized && !quantumTick) continue;
      apply(sammy.front, sammy.color, graduate);
      sammy.input.a = false;
      sammy.input.b = false;
    }

    header();
  }

  ctx.putImageData(bitmap, 0, 0);
}

cls();
title();

on("press", (event) => {
  const { type, button } = event;
  if (type === "system" && state !== "title") {
    if (button === "ONE_PLAYER") app.classList.toggle("dip1");
    if (button === "TWO_PLAYER") app.classList.toggle("dip2");
  } else if (type === "button") {
    const input = snakes[(event.player ?? 0) - 1]?.input;
    if (!input) return;
    if (button === "A") {
      input.a = true;
    } else if (button === "B") {
      input.b = true;
    } else if (
      button === "UP" ||
      button === "DOWN" ||
      button === "LEFT" ||
      button === "RIGHT"
    ) {
      console.log(button);
      input.dpad.push(button);
    }
  }
});
